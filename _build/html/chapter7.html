

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>7. Survival analysis: non-parametric, semi-parametric, parametric &#8212; Stata Programming</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chapter7';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="8. Multilevel, hierarchical Models" href="chapter8.html" />
    <link rel="prev" title="6 GitHub Repository for Collaboration" href="chapter6.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="https://brand.jhu.edu/assets/uploads/sites/5/2014/06/university_logo_small_vertical_blue.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="https://brand.jhu.edu/assets/uploads/sites/5/2014/06/university_logo_small_vertical_blue.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Preface
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="chapter1.html">1. Philosophy, overview, directory, simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter2.html">2. Return values, macros, programs</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter3.html">3. Program syntax, _request(), and prompt-based programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter4.html">4. Intermediate file management: from a remote location</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter5.html">5. Review of Weeks 1 - 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter6.html">6 GitHub Repository for Collaboration</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">7. Survival analysis: non-parametric, semi-parametric, parametric</a></li>
<li class="toctree-l1"><a class="reference internal" href="chapter8.html">8. Multilevel, hierarchical Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickrefs.html">Quick References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fchapter7.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/chapter7.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>7. Survival analysis: non-parametric, semi-parametric, parametric</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">7.1 Parameters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric">Non-parametric</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#semi-parametric">Semi-parametric</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inferences">7.2 Inferences</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h-a-text-self-reported-health-sim-age"><span class="math notranslate nohighlight">\(H_a: \text{Self-reported health} \sim Age\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adjust-for-age-and-other-demographics">Adjust for age and other demographics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#updates">7.3 Updates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transparency">7.4 Transparency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-parameters">7.5 Extracting Parameters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#e-b">e(b)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#e-v">e(V)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab">7.6 Lab</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation-and-initial-analysis">Data Preparation and Initial Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#homework">7.7 Homework</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="survival-analysis-non-parametric-semi-parametric-parametric">
<h1>7. Survival analysis: non-parametric, semi-parametric, parametric<a class="headerlink" href="#survival-analysis-non-parametric-semi-parametric-parametric" title="Permalink to this heading">#</a></h1>
<section id="parameters">
<h2>7.1 Parameters<a class="headerlink" href="#parameters" title="Permalink to this heading">#</a></h2>
<section id="non-parametric">
<h3>Non-parametric<a class="headerlink" href="#non-parametric" title="Permalink to this heading">#</a></h3>
<Details>
   <Summary>Click to view the Stata code</Summary>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span>cls 
<span class="c1">//1. data</span>
<span class="k">global</span> repo <span class="s">&quot;https://github.com/jhustata/project/raw/main/&quot;</span>
<span class="k">global</span> nhanes <span class="s">&quot;https://wwwn.cdc.gov/Nchs/Nhanes/&quot;</span>

<span class="c1">//2. code</span>
<span class="k">do</span> <span class="vg">${repo}</span>followup<span class="m">.</span>do
<span class="k">save</span> followup,<span class="k"> replace</span> 
import sasxport5 <span class="s">&quot;</span><span class="vg">${nhanes}</span><span class="s">1999-2000/DEMO.XPT&quot;</span>,<span class="k"> clear</span>
<span class="k">merge</span> <span class="m">1</span>:<span class="m">1</span> seqn using followup, nogen
<span class="k">save</span> survey_followup,<span class="k"> replace</span> 

<span class="c1">//3. parameters</span>
import sasxport5 <span class="s">&quot;</span><span class="vg">${nhanes}</span><span class="s">1999-2000/HUQ.XPT&quot;</span>,<span class="k"> clear</span>
<span class="k">tab</span> huq010 
<span class="k">merge</span> <span class="m">1</span>:<span class="m">1</span> seqn using survey_followup, nogen<span class="k"> keep</span>(matched)
<span class="k">rm</span> followup<span class="m">.</span>dta
<span class="k">rm</span> survey_followup<span class="m">.</span>dta
<span class="k">g</span> years=permth_int<span class="o">/</span><span class="m">12</span>
<span class="k">stset</span> years, fail(mortstat)
<span class="k">replace</span> huq010=.<span class="k"> if</span> huq010<span class="o">==</span><span class="m">9</span>
<span class="k">label</span> define huq <span class="m">1</span> <span class="s">&quot;Excellent&quot;</span> <span class="m">2</span> <span class="s">&quot;Very Good&quot;</span> <span class="m">3</span> <span class="s">&quot;Good&quot;</span> <span class="m">4</span> <span class="s">&quot;Fair&quot;</span> <span class="m">5</span> <span class="s">&quot;Poor&quot;</span>
<span class="k">label</span> values huq010 huq 
<span class="k">levelsof</span> huq010,<span class="k"> local</span>(numlevels)
<span class="k">local</span> i=<span class="m">1</span>
<span class="k">foreach l</span> of<span class="k"> numlist</span> <span class="nv">`numlevels&#39;</span> {
<span class="k">    local</span> vallab: value<span class="k"> label</span> huq010 
<span class="k">	local</span> catlab:<span class="k"> lab</span> <span class="nv">`vallab&#39;</span> <span class="nv">`l&#39;</span>
<span class="k">	global</span> legend<span class="nv">`i&#39;</span> = <span class="s">&quot;</span><span class="nv">`catlab&#39;</span><span class="s">&quot;</span>
<span class="k">	local</span> i= <span class="nv">`i&#39;</span> <span class="o">+</span> <span class="m">1</span>
}
<span class="k">save</span> week7,<span class="k"> replace</span> 
<span class="k">sts graph</span>, <span class="cs">///</span>
<span class="k">    by</span>(huq010) <span class="cs">///</span>
	fail <span class="cs">///</span>
	per(<span class="m">100</span>) <span class="cs">///</span>
	ylab(<span class="m">0</span>(<span class="m">20</span>)<span class="m">80</span> , <span class="cs">///</span>
<span class="k">	    format</span>(<span class="nx">%2.0f</span>) <span class="cs">///</span>
	) <span class="cs">///</span>
	xlab(<span class="m">0</span>(<span class="m">5</span>)<span class="m">20</span>) <span class="cs">///</span>
	tmax(<span class="m">20</span>) <span class="cs">///</span>
	ti(<span class="s">&quot;Self-Reported Health and Mortality&quot;</span>) <span class="cs">///</span>
	legend( <span class="cs">///</span>
<span class="k">	    order</span>(<span class="m">5</span> <span class="m">4</span> <span class="m">3</span> <span class="m">2</span> <span class="m">1</span>) <span class="cs">///</span>
<span class="k">		lab</span>(<span class="m">1</span> <span class="s">&quot;</span><span class="vg">$legend1</span><span class="s">&quot;</span>) <span class="cs">///</span>
<span class="k">		lab</span>(<span class="m">2</span> <span class="s">&quot;</span><span class="vg">$legend2</span><span class="s">&quot;</span>) <span class="cs">///</span>
<span class="k">		lab</span>(<span class="m">3</span> <span class="s">&quot;</span><span class="vg">$legend3</span><span class="s">&quot;</span>) <span class="cs">///</span>
<span class="k">		lab</span>(<span class="m">4</span> <span class="s">&quot;</span><span class="vg">$legend4</span><span class="s">&quot;</span>) <span class="cs">///</span>
<span class="k">		lab</span>(<span class="m">5</span> <span class="s">&quot;</span><span class="vg">$legend5</span><span class="s">&quot;</span>) <span class="cs">///</span>
		ring(<span class="m">0</span>) pos(<span class="m">11</span>) <span class="cs">///</span>
	)
<span class="k">graph</span> export nonpara<span class="m">.</span>png,<span class="k"> replace</span> 
</pre></div>
</div>
</Details>
<p><img alt="" src="_images/nonpara.png" /></p>
</section>
<section id="semi-parametric">
<h3>Semi-parametric<a class="headerlink" href="#semi-parametric" title="Permalink to this heading">#</a></h3>
<Details>
   <Summary>Click to view the Stata code</Summary>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="cm">/* -- earlier code --*/</span>
<span class="k">stcox</span> i<span class="m">.</span>huq010, basesurv(s0)
<span class="k">matrix</span> define<span class="k"> mat</span> = <span class="nf">r</span>(table)
<span class="k">matrix list mat</span> 
<span class="k">matrix mat</span> =<span class="k"> mat</span>&#39;
<span class="k">svmat mat</span>
<span class="k">preserve</span> 
<span class="k">keep mat</span><span class="o">*</span>
<span class="k">drop if</span> <span class="nf">missing</span>(mat1)
<span class="k">rename</span> (mat1 mat2 mat3 mat4 mat5 mat6 mat7 mat8 mat9)(b<span class="k"> se</span> z p ll ul df crit eform)
<span class="k">g</span> x=_n
<span class="k">replace</span> b=<span class="nf">log</span>(b)
<span class="k">replace</span> ll=<span class="nf">log</span>(ll)
<span class="k">replace</span> ul=<span class="nf">log</span>(ul)
<span class="k">twoway</span> (scatter b x) || <span class="cs">///</span>
       (rcap ll ul x, <span class="cs">///</span>
	       yline(<span class="m">0</span>, lcol(lime)) <span class="cs">///</span>
		   ylab( <span class="cs">///</span>
		       <span class="o">-</span><span class="m">2.08</span> <span class="s">&quot;0.125&quot;</span> <span class="cs">///</span>
			   <span class="o">-</span><span class="m">1.39</span> <span class="s">&quot;0.25&quot;</span> <span class="cs">///</span>
			   <span class="o">-</span>.<span class="m">69</span> <span class="s">&quot;0.5&quot;</span> <span class="cs">///</span>
			     <span class="m">0</span> <span class="s">&quot;1&quot;</span>  <span class="cs">///</span>
			   .<span class="m">69</span> <span class="s">&quot;2&quot;</span> <span class="cs">///</span>
			   <span class="m">1.39</span> <span class="s">&quot;4&quot;</span> <span class="cs">///</span>
			   <span class="m">2.08</span> <span class="s">&quot;8&quot;</span> <span class="cs">///</span>
			   <span class="m">2.78</span> <span class="s">&quot;16&quot;</span>) <span class="cs">///</span>
		   legend(off)  <span class="cs">///</span>
		xlab( <span class="cs">///</span>
           <span class="m">1</span> <span class="s">&quot;</span><span class="vg">$legend1</span><span class="s">&quot;</span> <span class="cs">///</span>
		   <span class="m">2</span> <span class="s">&quot;</span><span class="vg">$legend2</span><span class="s">&quot;</span> <span class="cs">///</span>
		   <span class="m">3</span> <span class="s">&quot;</span><span class="vg">$legend3</span><span class="s">&quot;</span> <span class="cs">///</span>
		   <span class="m">4</span> <span class="s">&quot;</span><span class="vg">$legend4</span><span class="s">&quot;</span> <span class="cs">///</span>
		   <span class="m">5</span> <span class="s">&quot;</span><span class="vg">$legend5</span><span class="s">&quot;</span>) <span class="cs">///</span>
	   xti(<span class="s">&quot;Self-Reported Health&quot;</span>) <span class="cs">///</span>
	   	   ) 
<span class="k">graph</span> export semipara_unadj<span class="m">.</span>png,<span class="k"> replace</span> 
<span class="k">graph save</span> semipara_unadj<span class="m">.</span>gph,<span class="k"> replace</span> 
<span class="k">restore</span> 
</pre></div>
</div>
</Details>
<p><img alt="" src="_images/semipara_unadj.png" /></p>
</section>
</section>
<section id="inferences">
<h2>7.2 Inferences<a class="headerlink" href="#inferences" title="Permalink to this heading">#</a></h2>
<Details>
   <Summary>Click to view the Stata code</Summary>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">hist</span> ridageyr 
<span class="k">graph</span> export nonpara<span class="m">.</span>png,<span class="k"> replace</span> 
<span class="c1">//replace ridageyr=ridageyr/10</span>
<span class="k">capture drop</span> s0 
<span class="k">stcox</span> i<span class="m">.</span>huq010 ridageyr riagendr, basesurv(s0)
<span class="k">return list</span>
<span class="k">matrix</span> define mat_adj=<span class="nf">r</span>(table)
<span class="k">matrix</span> define mat_adj=mat_adj&#39;
<span class="k">matrix list</span> mat_adj
<span class="k">svmat</span> mat_adj
<span class="k">keep</span> mat_adj<span class="o">*</span>
<span class="k">drop if</span> <span class="nf">missing</span>(mat_adj1)
<span class="k">rename</span> (mat_adj1 mat_adj2 mat_adj3 mat_adj4 mat_adj5 mat_adj6 mat_adj7 mat_adj8 mat_adj9)(b<span class="k"> se</span> z p ll ul df crit eform)
<span class="k">g</span> x=_n
<span class="k">replace</span> b=<span class="nf">log</span>(b)
<span class="k">replace</span> ll=<span class="nf">log</span>(ll)
<span class="k">replace</span> ul=<span class="nf">log</span>(ul)
<span class="k">twoway</span> (scatter b x<span class="k"> if</span> <span class="nf">inrange</span>(x,<span class="m">1</span>,<span class="m">5</span>)) || <span class="cs">///</span>
       (rcap ll ul x<span class="k"> if</span> <span class="nf">inrange</span>(x,<span class="m">1</span>,<span class="m">5</span>), <span class="cs">///</span>
	       yline(<span class="m">0</span>, lcol(lime)) <span class="cs">///</span>
		   ylab( <span class="cs">///</span>
		       <span class="o">-</span><span class="m">2.08</span> <span class="s">&quot;0.125&quot;</span> <span class="cs">///</span>
			   <span class="o">-</span><span class="m">1.39</span> <span class="s">&quot;0.25&quot;</span> <span class="cs">///</span>
			   <span class="o">-</span>.<span class="m">69</span> <span class="s">&quot;0.5&quot;</span> <span class="cs">///</span>
			     <span class="m">0</span> <span class="s">&quot;1&quot;</span>  <span class="cs">///</span>
			   .<span class="m">69</span> <span class="s">&quot;2&quot;</span> <span class="cs">///</span>
			   <span class="m">1.39</span> <span class="s">&quot;4&quot;</span> <span class="cs">///</span>
			   <span class="m">2.08</span> <span class="s">&quot;8&quot;</span> <span class="cs">///</span>
			   <span class="m">2.78</span> <span class="s">&quot;16&quot;</span>) <span class="cs">///</span>
		   legend(off)  <span class="cs">///</span>
		xlab( <span class="cs">///</span>
           <span class="m">1</span> <span class="s">&quot;</span><span class="vg">$legend1</span><span class="s">&quot;</span> <span class="cs">///</span>
		   <span class="m">2</span> <span class="s">&quot;</span><span class="vg">$legend2</span><span class="s">&quot;</span> <span class="cs">///</span>
		   <span class="m">3</span> <span class="s">&quot;</span><span class="vg">$legend3</span><span class="s">&quot;</span> <span class="cs">///</span>
		   <span class="m">4</span> <span class="s">&quot;</span><span class="vg">$legend4</span><span class="s">&quot;</span> <span class="cs">///</span>
		   <span class="m">5</span> <span class="s">&quot;</span><span class="vg">$legend5</span><span class="s">&quot;</span>) <span class="cs">///</span>
	   xti(<span class="s">&quot;Self-Reported Health&quot;</span>) <span class="cs">///</span>
	   	   ) 
<span class="k">graph</span> export semipara_adj<span class="m">.</span>png,<span class="k"> replace</span> 
<span class="k">graph save</span> semipara_adj<span class="m">.</span>gph,<span class="k"> replace</span> 
</pre></div>
</div>
</Details>
<section id="h-a-text-self-reported-health-sim-age">
<h3><span class="math notranslate nohighlight">\(H_a: \text{Self-reported health} \sim Age\)</span><a class="headerlink" href="#h-a-text-self-reported-health-sim-age" title="Permalink to this heading">#</a></h3>
<p><img alt="" src="_images/agedist.png" /></p>
</section>
</section>
<section id="adjust-for-age-and-other-demographics">
<h2>Adjust for age and other demographics<a class="headerlink" href="#adjust-for-age-and-other-demographics" title="Permalink to this heading">#</a></h2>
<p><img alt="" src="_images/semipara_adj.png" /></p>
</section>
<section id="updates">
<h2>7.3 Updates<a class="headerlink" href="#updates" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Comment on the coefficients of the parameters in the unadjusted analysis</p></li>
<li><p>What is the impact on your inferences of accounting for age, sex and race?</p></li>
<li><p>Are you content with your inferences after adjusting for demographics?</p></li>
<li><p>Might there be other potential confounders from questionnaire, exam, and labs?</p></li>
<li><p>How might you prepare the updated analysis to take additional variables into consideration?</p></li>
<li><p>You might already know that you lose degrees of freedom as you add parameters to your model</p></li>
<li><p>So how about increasing your “freedoms” by having a larger population size? Could you write a script that allows any “visitor” to your website or repo to test this hypothesis on a larger study population, taking into account additional survey years?</p></li>
<li><p>This latter issue is the definitive update for <strong>week 8</strong> of the class</p></li>
</ul>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="k">graph</span> combine semipara_unadj<span class="m">.</span>gph semipara_adj<span class="m">.</span>gph, <span class="cs">///</span>
    ycommon ti(<span class="s">&quot;Hazard Ratio, 95%CI&quot;</span>) 
<span class="k">graph</span> export unadj_adj<span class="m">.</span>png,<span class="k"> replace</span> 
</pre></div>
</div>
<p><img alt="" src="unadj_adj.png" /></p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span><span class="c1">//these variable names don&#39;t exist in the dataset, this is a mere demo</span>
<span class="k">di</span> <span class="s">&quot;What do you wish to adjust for in this analysis?&quot;</span> _request(<span class="vg">$varlist</span>)
<span class="k">capture program drop</span> selfassess
<span class="k">program</span> define selfassess
<span class="k">    syntax varlist</span> 
<span class="k">    stcox</span> i<span class="m">.</span>huq010 <span class="nv">`varlist&#39;</span>
<span class="k">end</span> 
selfassess <span class="vg">$varlist</span>
</pre></div>
</div>
<p>In the above example, you might ask your collaborators to list what they believe might be confounders in the assocation between self-assessed health status and mortality</p>
</section>
<section id="transparency">
<h2>7.4 Transparency<a class="headerlink" href="#transparency" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>The “most open” you can ever get in the “Open Science” enterprise is by using a public GitHub repo</p></li>
<li><p>Of the topics we’ve discussed, including data, code, parameters, inferences, and updates, “data” is of particular concern if there might be “disclosure risks”</p></li>
<li><p>In the Stata II (Intermediate) we’ll assume all data are de-identified and have zero disclosure risk. Perhaps because we’ve de-identified the data or because we are using simulated datasets</p></li>
<li><p>But in Stata III (Advanced) we’ll learn how to use private repos for data storage. We’ll consider how to grant limited access by means of temporary “tokens”</p></li>
<li><p>Regardless, the parameters of our models represent reduced dimensions of data and have no associated disclosure risks</p></li>
<li><p>So we should consider “extracting” parameters from our data and from that point forth being 100% transparent in our workflow</p></li>
</ul>
</section>
<section id="extracting-parameters">
<h2>7.5 Extracting Parameters<a class="headerlink" href="#extracting-parameters" title="Permalink to this heading">#</a></h2>
<p>Virtually all scientific inferences from quantitive analyses can be made as long as you have the <code class="docutils literal notranslate"><span class="pre">beta</span></code> coefficients and the <code class="docutils literal notranslate"><span class="pre">variance-covariance</span></code> matrix following a multivariable regression.</p>
<p>Because these parameters have zero discolure risk, you are encouraged to have them made available to the public in your public GitHub repo</p>
<p>You’d do the public an extra favor if you laid out a generalizable program that allows anyone to add new parameters (i.e., variables and interactions amongst them) to the model with little extra effort</p>
<p>Let’s restore the analytic dataset we’d created. If this dataset has disclosure risks, the we should extract “all” the relevant parameters for statistical inference, make them publically available, and display our findings</p>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span>cls 
<span class="k">use</span> week7,<span class="k"> clear</span>
</pre></div>
</div>
<section id="e-b">
<h3>e(b)<a class="headerlink" href="#e-b" title="Permalink to this heading">#</a></h3>
<Details>
   <Summary>Click to view the Stata code</Summary>
<div class="highlight-stata notranslate"><div class="highlight"><pre><span></span>cls 
<span class="k">use</span> week7,<span class="k"> clear</span>
<span class="k">replace</span> riagendr=riagendr<span class="m">-1</span>
<span class="k">stcox</span> i<span class="m">.</span>huq010 ridageyr riagendr, basesurv(s0)
<span class="k">keep</span> s0 _t _t0 _st _d 
<span class="k">save</span> s0,<span class="k"> replace</span> 
<span class="k">ereturn list</span> 
<span class="k">matrix</span> beta =<span class="k"> e</span>(b)
<span class="k">matrix</span> vcov =<span class="k"> e</span>(V)
<span class="k">matrix</span> SV = ( <span class="cs">///</span>
    <span class="m">0</span>, <span class="cs">///</span>
	<span class="m">1</span>, <span class="cs">///</span>
	<span class="m">0</span>, <span class="cs">///</span>
	<span class="m">0</span>, <span class="cs">///</span>
	<span class="m">0</span>, <span class="cs">///</span>
	<span class="m">40</span>, <span class="cs">///</span>
	<span class="m">1</span> <span class="cs">///</span>
)
<span class="k">matrix</span> SV_ref = ( <span class="cs">///</span>
    <span class="m">0</span>, <span class="cs">///</span>
	<span class="m">1</span>, <span class="cs">///</span>
	<span class="m">0</span>, <span class="cs">///</span>
	<span class="m">0</span>, <span class="cs">///</span>
	<span class="m">0</span>, <span class="cs">///</span>
	<span class="m">60</span>, <span class="cs">///</span>
	<span class="m">1</span> <span class="cs">///</span>
)
<span class="c1">//absolute risk</span>
<span class="k">matrix</span> risk_score = SV <span class="o">*</span> beta&#39;
<span class="k">matrix list</span> risk_score
<span class="k">di</span> <span class="nf">exp</span>(risk_score[<span class="m">1</span>,<span class="m">1</span>])
<span class="k">matrix</span> var_prediction = SV <span class="o">*</span> vcov <span class="o">*</span> vcov&#39;
<span class="k">matrix</span> se_prediction = <span class="nf">sqrt</span>(var_prediction[<span class="m">1</span>,<span class="m">1</span>])

<span class="k">matrix</span> risk_score_ref = SV_ref <span class="o">*</span> beta&#39;
<span class="k">matrix list</span> risk_score_ref
<span class="k">di</span> <span class="nf">exp</span>(risk_score_ref[<span class="m">1</span>,<span class="m">1</span>])
<span class="k">matrix</span> var_prediction_ref = SV_ref <span class="o">*</span> vcov <span class="o">*</span> vcov&#39;
<span class="k">matrix</span> se_prediction_ref = <span class="nf">sqrt</span>(var_prediction_ref[<span class="m">1</span>,<span class="m">1</span>])

<span class="k">local</span> hr = <span class="nf">exp</span>(risk_score_ref[<span class="m">1</span>,<span class="m">1</span>])<span class="o">/</span><span class="nf">exp</span>(risk_score[<span class="m">1</span>,<span class="m">1</span>])
<span class="k">di</span> <span class="nv">`hr&#39;</span>

<span class="c1">//di &quot;We conclude that `exp(risk_score[1,1])&#39;&quot;</span>

<span class="c1">//</span>
<span class="k">g</span> f0 = (<span class="m">1</span> <span class="o">-</span> s0) <span class="o">*</span> <span class="m">100</span> 
<span class="k">g</span> f1_ = f0 <span class="o">*</span> <span class="nf">exp</span>(risk_score[<span class="m">1</span>,<span class="m">1</span>])
<span class="k">line</span> f1 _t , <span class="cs">///  </span>
<span class="k">    sort</span> connect(step step) <span class="cs">///</span>
	legend(ring(<span class="m">0</span>)) <span class="cs">///</span>
    ylab(<span class="m">0</span>(<span class="m">5</span>)<span class="m">20</span>) xlab(<span class="m">0</span>(<span class="m">5</span>)<span class="m">20</span>) <span class="cs">///</span>
    yti(<span class="s">&quot;&quot;</span>) <span class="cs">///</span>
    ti(<span class="s">&quot;Scenario, %&quot;</span>, pos(<span class="m">11</span>)) <span class="cs">///</span>
    xti(<span class="s">&quot;Years&quot;</span>) <span class="cs">///</span>
<span class="k">    note</span>(<span class="s">&quot;40yo male who self-describes as being in good health&quot;</span> <span class="cs">///</span>
                  ,size(<span class="m">1.5</span>) <span class="cs">///</span>
		)
<span class="k">graph</span> export scenario<span class="m">.</span>png,<span class="k"> replace</span> 
</pre></div>
</div>
</Details>
<p><img alt="" src="_images/scenario.png" /></p>
</section>
<section id="e-v">
<h3>e(V)<a class="headerlink" href="#e-v" title="Permalink to this heading">#</a></h3>
<p>Estimating the 95%CI interval for specific scenarios is beyond the scope of this class and will be left to Stata III (Advanced)</p>
</section>
</section>
<section id="lab">
<h2>7.6 Lab<a class="headerlink" href="#lab" title="Permalink to this heading">#</a></h2>
<section id="data-preparation-and-initial-analysis">
<h3>Data Preparation and Initial Analysis<a class="headerlink" href="#data-preparation-and-initial-analysis" title="Permalink to this heading">#</a></h3>
<p><strong>Objective</strong>: Prepare the data from last weeks <strong>lab 6</strong>, analyse it using nonparametric (Kaplan-Meier), semiparametric (Cox Regression), and parametric (Weibull regression). Generate figures to showcase absolute risks (i.e., cumulative incidence) and relative risks (i.e., hazard ratios). You may adjust for <code class="docutils literal notranslate"><span class="pre">age</span></code>, <code class="docutils literal notranslate"><span class="pre">sex</span></code>, and <code class="docutils literal notranslate"><span class="pre">race</span></code>. But consider expanding the list of confounders so that you achieve unbiased inferences</p>
<p>Provide documentation on your homepage and include necessary links to ease the work of visitor who is trying to navigate your website</p>
</section>
</section>
<section id="homework">
<h2>7.7 Homework<a class="headerlink" href="#homework" title="Permalink to this heading">#</a></h2>
<p>Generate <code class="docutils literal notranslate"><span class="pre">.html</span></code> files of your Stata output using the <code class="docutils literal notranslate"><span class="pre">dyndoc</span></code> command and provide links to this Stata output on your website to showoff the richness of your output.</p>
<p>Of course you can document your Stata code <strong>without</strong> the use of <code class="docutils literal notranslate"><span class="pre">dyndoc</span></code>, by simply building other <code class="docutils literal notranslate"><span class="pre">.md</span></code> files with annotation and notes intersperced with Stata code – just as this classbook has it.</p>
<p>But for this Stata Programming II (Intermediate) class, you must produce a seperate website with output straight out of Stata. Please create a link to this <code class="docutils literal notranslate"><span class="pre">dyndoc</span></code> output on your homepage.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="chapter6.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">6 GitHub Repository for Collaboration</p>
      </div>
    </a>
    <a class="right-next"
       href="chapter8.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">8. Multilevel, hierarchical Models</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">7.1 Parameters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-parametric">Non-parametric</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#semi-parametric">Semi-parametric</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inferences">7.2 Inferences</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h-a-text-self-reported-health-sim-age"><span class="math notranslate nohighlight">\(H_a: \text{Self-reported health} \sim Age\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adjust-for-age-and-other-demographics">Adjust for age and other demographics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#updates">7.3 Updates</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transparency">7.4 Transparency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#extracting-parameters">7.5 Extracting Parameters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#e-b">e(b)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#e-v">e(V)</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab">7.6 Lab</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preparation-and-initial-analysis">Data Preparation and Initial Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#homework">7.7 Homework</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Abimereki Muzaale
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>